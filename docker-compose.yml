# web server
nginx:
  image: nginx:latest
  ports:
    - "80:80"
    - "443:443"
  volumes:
    # app
    - ./app/site_python:/usr/share/nginx/html
    # nginx configs
    - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    - ./nginx/conf.d/:/etc/nginx/conf.d/:ro
    # certificates
    - ./nginx/ca/server.crt/:/etc/nginx/server.crt:ro
    - ./nginx/ca/server.key/:/etc/nginx/server.key:ro
  links:
    #- fpm:__DOCKER_PHP_FPM__
    - tomcat:host_tomcat
    - python3:host_python
    - fpm56:host_php
    - mysql:host_mysql

python3:
#: $ docker run -it --rm --name my-running-script -v "$PWD":/usr/src/myapp -w /usr/src/myapp python:3 python your-daemon-or-script.py
  build: ./buildpy3
  ports: 
    - "8080"
  volumes:
    - ./app/site_python:/usr/src/myapp
  links:
    - mysql:host_mysql
  entrypoint: /usr/src/myapp/run.sh
  #entrypoint: tail -f /var/log/dmesg


tomcat:
  image: tomcat:7.0.77-jre8
  ports: 
    - "8080"
  volumes:
    - ./app/site_tomcat:/usr/local/tomcat/webapps/website
  links:
    - mysql:host_mysql

# php-fpm
fpm:
  build: ./php-fpm
  #entrypoint: echo "ijustbedisabled"
  #entrypoint: tail -f /var/log/dmesg
  ports:
    - "9000"
  volumes:
    - ./app/site_php:/usr/share/nginx/html
    # Your php.ini
    - ./php-fpm/php.ini-production:/usr/local/etc/php/php.ini:ro
  # environment:
    # Set your APP env variables here:
    # - APP_KEY=
    # - DB_HOST=
    # - DB_DATABASE=
    # - DB_USERNAME=
    # - DB_PASSWORD=
  links:
    - mysql:host_mysql
fpm56:
  build: ./php5.6-fpm
  #entrypoint: echo "ijustbedisabled"
  #entrypoint: tail -f /var/log/dmesg
  ports:
    - "9000"
  volumes:
    - ./app/site_php:/usr/share/nginx/html
    # Your php.ini
    - ./php5.6-fpm/php.ini-production:/usr/local/etc/php/php.ini:ro
  # environment:
    # Set your APP env variables here:
    # - APP_KEY=
    # - DB_HOST=
    # - DB_DATABASE=
    # - DB_USERNAME=
    # - DB_PASSWORD=
  links:
    - mysql:host_mysql

# database
mysql:
  image: mysql:latest
  ports:
    # Allow client to access 3306
    - "3306:3306"
  volumes:
    # NOTE: your data will be stored in ./mysql
    - ./mysql:/var/lib/mysql
  environment:
    - MYSQL_ROOT_PASSWORD=your_mysql_password
